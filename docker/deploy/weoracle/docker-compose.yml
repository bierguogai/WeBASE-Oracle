version: '3.7'
services:
  weoracle-web:
    container_name: weoracle-web
    image: ${image_organization}/weoracle-web:${weoracle_version}
    restart: always
    network_mode: "host"
    environment:
      - NODE_ENV=production
    volumes:
      - ./log/nginx:/var/log/nginx/

  weoracle-server:
    container_name: weoracle-service
    image: ${image_organization}/weoracle-service:${weoracle_version}
    restart: always
    network_mode: "host"
    environment:
      - "SPRING_PROFILES_ACTIVE=docker"
    volumes:
      - ./log/server:/dist/log
      - ./weoracle.yml:/dist/conf/application-docker.yml
      - ../fiscobcos/nodes/127.0.0.1/sdk/ca.crt:/dist/conf/ca.crt
      - ../fiscobcos/nodes/127.0.0.1/sdk/node.crt:/dist/conf/node.crt
      - ../fiscobcos/nodes/127.0.0.1/sdk/node.key:/dist/conf/node.key
      - ./key:/dist/key

  weoracle-mysql:
    container_name: weoracle-mysql
    image: mysql:${mysql_version}
    restart: always
    network_mode: "host"
    environment:
      MYSQL_ROOT_PASSWORD: defaultPassword # 箭头前后中间不能带空格，会将匹配的清楚
      MYSQL_DATABASE: weoracle
      MYSQL_USER: weoracle
      MYSQL_PASSWORD: defaultPassword # 箭头前后中间不能带空格，会将匹配的清楚
    command:
      - 'mysqld'
      - '--character-set-server=utf8mb4'
      - '--collation-server=utf8mb4_unicode_ci'
      - '--init-connect="SET NAMES utf8mb4"'
      - '--default-time-zone=+8:00'
      - '--log-error=/var/log/mysql/error.log'
      - '--log-error-verbosity=3'
    volumes:
      # MySQL数据库挂载到host物理机目录
      - "./mysql/data:/var/lib/mysql"

